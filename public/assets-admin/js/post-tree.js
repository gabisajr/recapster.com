define(["jquery","i18n","fancytree"],function(t,a){var e=t("#post-categories-tree-data");if(e.length){var s=JSON.parse(e.text().trim()),r=t("#post-categories-tree");r.fancytree({source:s,extensions:["table"],table:{indentation:20,nodeColumnIdx:0},renderColumns:function(e,s){var r=s.node,n=t(r.tr).find(">td");if(r.folder){var o=r.data.id;r.data.posts_count=r.data.posts_count||0,r.data.posts_count&&n.eq(1).html("<small><samp>"+r.data.posts_count+" posts</samp></small>"),n.eq(4).html('<a class="text-muted" href="/admin/post/category/'+o+'"><i class="fa fa-fw fa-gear"></i></a><button type="button" style="margin:0 20px" class="btn btn-xs btn-default" name="remove" title="'+a("Удалить")+'"><i class="fa fa-trash"></i></button><small><a href="/admin/post/item?category='+o+'" style="margin-right:20px;">'+a("Добавить пост")+'</a><a href="/admin/post/category?parent='+o+'" style="margin-right:20px;">'+a("Добавить подкатегорию")+'</a><a href="/admin/post/list?category='+o+'">'+a("Список постов")+"</a></small>")}else{var i=r.data.helpful_value||0;if(0!=i){var l=t("<small><strong><samp>"+(i>0?"+":"")+i+"</samp></strong></small>");l.addClass(i<0?"text-danger":"text-success"),n.eq(2).append(l)}n.eq(3).html("<small><samp>"+r.data.updated+"</samp></small>"),n.eq(4).html('<a href="/admin/post/item/'+r.data.id+'" class="text-muted"><i class="fa fa-fw fa-pencil"></i></a><button type="button" style="margin:0 20px" class="btn btn-xs btn-default" name="remove" title="'+a("Удалить")+'"><i class="fa fa-trash"></i></button><small><a href="'+r.data.url+'" target="_blank">'+a("Открыть на сайте")+"</a></small>")}}}),r.delegate("button[name=remove]","click",function(e){e.stopPropagation();var s=t.ui.fancytree.getNode(e),r=t(e.target),n=s.title;if(s.folder){var o=a("Вы действительно хотите удалить категорию :title с сайта? При удалении категории также будут удалены все вложенные подкатегории и посты",{":title":"<strong>"+n+"</strong>"});window.confirmModal(o,function(){t.ajax({url:"/admin/post/remove_category",type:"post",data:{id:s.data.id},beforeSend:function(){r.prop("disabled",!0)},success:function(){for(window.alertMessage(a("Категория удалена"),"success");s.hasChildren();)s.getFirstChild().remove();s.remove()},error:function(t){var a=404==t.status?"Error 404: URL not found":t.responseText;window.alertMessage(a,"error")}})})}else o=a("Вы действительно хотите удалить пост :title с сайта?",{":title":"<strong>"+n+"</strong>"}),window.confirmModal(o,function(){t.ajax({url:"/admin/post/remove",type:"post",data:{id:s.data.id},beforeSend:function(){r.prop("disabled",!0)},success:function(){window.alertMessage(a("Пост удален"),"success"),s.remove()},error:function(t){var a=404==t.status?"Error 404: URL not found":t.responseText;window.alertMessage(a,"error")}})})})}});