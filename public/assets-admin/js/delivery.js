define(["jquery","async"],function(e,t){function a(e,t){var a=e+1,s=Math.round(a/t*100),i=a+"/"+t+" ("+s+"%)";r.css("width",s+"%").attr("aria-valuenow",s).text(i),s>=100?(r.removeClass("progress-bar-striped active"),l.prop("disabled",!1)):r.addClass("progress-bar-striped active")}function s(t,a,s){var i=e("<li><small>"+t+", "+a+"</small></li>");s?i.addClass("text-success"):i.addClass("text-danger"),n.append(i)}var i=e("form#delivery-form"),n=e(".delivery-log"),r=e("#delivery-progress"),l=i.find(":input[type=submit]");i.submit(function(r){r.preventDefault();var d=i.find(":input[name=template]").val(),p=i.find(":input[name=subject]").val(),u=i.find(":input[name=email]").val().split("\n"),c=u.length;n.text(""),l.prop("disabled",!0),d&&t.eachOfSeries(u,function(t,i,n){var r=t.split("|")[0],l=t.split("|")[1],u={template:d,email:r,name:l,subject:p};e.ajax({url:"/admin/delivery/send",type:"post",data:u,success:function(e){s(r,l,e.success)},error:function(){s(r,l,!1)},complete:function(){a(i,c),n(null)}})})})});