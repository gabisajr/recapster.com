define(["jquery","notify"],function(e){e.fn.entityList=function(t){var r=(t=t||{}).removeUrl;if(!r)return window.alert("specify removeUrl");var n=t.sortUrl;if(t.sortable&&!n)return window.alert("specify sortUrl");var o=e(this);t.afterRemove=t.afterRemove||!1,o.find("button[name=remove]").click(function(n){n.preventDefault();var o=e(this),i=o.closest("tr"),a=i.data("id"),s=i.find(".title").text().trim();s.length>45&&(s=s.substring(0,45)+"…");var f="Confirm delete <strong>"+s+"</strong>";t.removeQuestion&&(f=t.removeQuestion.replace("{title}",s)),window.confirmModal(f,function(){e.ajax({url:r,type:"post",data:{id:a},beforeSend:function(){o.prop("disabled",!0)},success:function(){window.alertMessage("Успешное удаление","success"),i.fadeOut(function(){i.remove(),t.afterRemove&&t.afterRemove()})},error:function(t){e.notify(t.responseText,"error")}})})}),o.find('button[name="sort"]').click(function(t){t.preventDefault();var r=e(this),i=[];o.find("tbody tr").each(function(){var t=e(this);i.push({id:t.data("id"),sort:t.find("input[name=sort]").val()||0})}),e.ajax({url:n,data:{sort_arr:i},type:"post",beforeSend:function(){r.find(".fa").show()},complete:function(){r.find(".fa").hide()},error:function(e){var t=404===e.status?"Error 404: URL not found":e.responseText;window.alertMessage(t,"error")},success:function(){location.reload()}})})}});