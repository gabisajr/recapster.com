define(["jquery","modal","i18n","autosize","modal/alert","fancybox"],function(e,n,o,a,t){function i(n){n.preventDefault();var a=e(this).find('[type="submit"]');e.ajax({url:this.action,type:this.method,data:e(this).serialize(),beforeSend:function(){a.prop("disabled",!0)},complete:function(){a.prop("disabled",!1),e.fancybox.close()},success:function(e){e.success?t.success(o("Ваша жалоба принята")):t.error(o("Не удалось отправить жалобу"))}})}var c,s;return function(o,t){var r=e.param([{name:"id",value:t},{name:"type",value:o}]);e.fancybox.open({type:"ajax",padding:0,tpl:{closeBtn:n.close},helpers:{overlay:{locked:!1}},href:"/claim/modal?"+r,beforeShow:function(){c=e("form#complain-form"),s=c.find(':input[name="message"]'),c.submit(i),a(s),s.on("autosize:resized",function(){e.fancybox.update()})},afterShow:function(){s.focus()}})}});