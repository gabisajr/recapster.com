define(["jquery","i18n","tplModalClose","fancybox","fileupload"],function(e,n,i){var t=e("#apply-job-modal"),a=t.find("#apply-job-form"),o=a.find(".resume");e(".open-apply-job-modal").fancybox({padding:0,fitToView:!1,href:"#apply-job-modal",scrolling:"visible",helpers:{overlay:{locked:!1}},tpl:{closeBtn:i},beforeShow:function(){var i=e(this.element).data(),o=i.jobCompany,r=i.jobTitle,d=i.jobId;t.find(".modal-title").html(r+" для <em>"+o+"</em>"),a.find('input[name="job"]').val(d),a.find('textarea[name="message"]').attr("placeholder",n("Расскажите :company почему они должны принять вас на работу",{":company":o}))},afterShow:function(){a.find(":input").filter(function(){var n=e(this).attr("name");return e.inArray(n,["firstname","tel","email","city","message"])>=0&&""==this.value}).eq(0).focus()},afterClose:function(){a.find(":input").removeClass("error"),a.find(".text-error").addClass("hidden").text("")}}),o.find('input[name="file"]').fileupload({url:"/upload",change:function(e,n){var i=n.files[0].name.trim();a.find('input[name="resume_name"]').val(i),o.find(".filename").text(i)},done:function(e,n){o.find('input[name="resume"]').val(n.result.path),o.find(".btns").hide(),o.find(".preview").show()}}),o.find(".delete").click(function(){o.find(".btns").show(),o.find(".preview").hide();var n=o.find('input[name="resume"]').val();e.post("/upload/remove",{path:n}),o.find(":input").val("")}),a.submit(function(n){n.preventDefault();var i;e.ajax({url:a.attr("action"),type:a.attr("method"),data:a.serialize(),beforeSend:function(){a.find(":input").prop("disabled",!0),i=setTimeout(function(){a.find(".preloader").show()},200)},complete:function(){a.find(":input").prop("disabled",!1),clearTimeout(i),a.find(".preloader").hide()},success:function(n){if(a.find(".text-error").text("").addClass("hidden"),a.find(":input").removeClass("error"),n.success)window.location.href=n.url;else{var i=n.errors||[];e.each(i,function(e,n){a.find(':input[name="'+e+'"]').addClass("error"),a.find(".error-"+e).text(n).removeClass("hidden")})}}})})});