define(["jquery","keyCodes","autocomplete","highlight"],function(e,o){return function(t,r){var i=t.find("input.title"),s=t.find("input.site");i.focus(function(){t.addClass("focus")}),i.is(":focus")&&i.trigger("focus"),t.find("input").keypress(function(r){e(this).closest(".field").removeClass("has-error"),r.keyCode==o.ENTER&&(t.data("type","review"),t.submit())}).keydown(function(e){e.keyCode==o.ESC&&t.trigger("reset")}),i.autocompleteCompany(),t.find(".btn-submit").click(function(e){e.preventDefault(),t.data("type",this.value),t.submit()}),t.submit(function(o){if(o.preventDefault(),!i.val().trim())return i.focus();var s=t.data("type")||"review",n=t.serializeArray();n.push({name:"type",value:s}),e.post("/add/form",n,function(o){if(o.form){var i=e(o.form);switch(t.trigger("hide").after(i),s){case"image":var n="add-images";break;case"review":n="review-form"}n?require([n],function(e){e(i,{autofocus:!0},function(e){return i.remove(),t.show().trigger("reset"),r(e)})}):window.alert("module not found")}else e.each(o.errors,function(e,o){var r=t.find("input."+e),i=r.closest(".field");i.is(":visible")?(i.addClass("has-error"),i.find(".help-block").text(o)):i.show(),r.focus()})})}),t.on("hide",function(){var o=e(this);o.hide(),o.find(".has-error").removeClass("has-error"),s.val("").closest(".field").hide()}),t.on("show",function(){e(this).show(),i.focus()}),t.on("reset",function(){t.find(".has-error").removeClass("has-error"),i.blur().val(""),s.blur().val(""),t.removeClass("focus")}),e(document).on("click",".add-form-cancel",function(o){o.preventDefault(),o.stopPropagation(),e(this).closest("form").remove(),t.trigger("show")}),e(document).click(function(o){var r=e(o.target).hasClass("add-form-go");s.val()||i.val()||r||t.trigger("reset")}),t.click(function(e){e.stopPropagation()}),e(document).on("click",".add-form-go",function(e){e.preventDefault(),i.focus()})}});