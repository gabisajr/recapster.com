define(["jquery","i18n","caretEnd","autosize","powertip","autocomplete"],function(e,t,o,i,n){function r(t){n(t.find(".powertip")),t.find("input.company_title").not(".ui-autocomplete-input").autocompleteCompany(),t.find("input.position_title").not(".ui-autocomplete-input").autocompletePosition(),t.find("input.city_title").not(".ui-autocomplete-input").autocompleteCity();var r=t.find("input.is_current"),c=t.find("select.end_month"),p=t.find("select.end_year"),a=t.find("textarea.text"),s=t.find("input.has_text"),u=t.find(".text-wrapper");return a.focus(o),i(a),r.change(function(){var t=e(this).is(":checked");c.prop("disabled",t).closest(".has-error").removeClass("has-error"),p.prop("disabled",t).closest(".has-error").removeClass("has-error")}),s.change(function(){e(this).is(":checked")?(u.show(),a.focus()):u.hide()}),t}var c=e("form#experience-form"),p=c.find(".experience-list");c.find(".experience-form-group").each(function(){r(e(this))}),c.find(".add-experience").click(function(t){t.preventDefault();var o=c.find(".experience-form-group").length;e.post("/tmpl/edit/experience/form-group",{index:o},function(t){var o=r(e(t));p.append(o),o.find("input.company_title").focus()})}),c.on("click",".group-delete",function(t){t.preventDefault(),t.stopPropagation(),e(this).closest(".group").remove(),e.post("/experience/delete",e(this).data())}),c.submit(function(t){var o=c.find('[type="submit"]');t.preventDefault(),e.ajax({url:c.attr("action"),data:c.serialize(),type:c.attr("method"),beforeSend:function(){o.prop("disabled",!0),c.find(".has-error").removeClass("has-error")},complete:function(){o.prop("disabled",!1)},success:function(t){if(t.success)window.scrollTo(0,0),window.location.reload();else{e.each(t.errors,function(t,o){var i=e(".experience-form-group").eq(t);e.each(o,function(e,t){i.find(":input."+e).closest(".form-group, .col").addClass("has-error")})});var o=e(".experience-form-group .has-error").eq(0).closest(".experience-form-group");o.length&&e("html, body").animate({scrollTop:o.offset().top},100)}}})})});