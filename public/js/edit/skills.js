define(["jquery","powertip","keyCodes","jquery-ui","highlight"],function(t,e,n){function i(){var n=s.find(".form-group-skill").length;t.post("/tmpl/edit/skills/form-group",{index:n},function(n){var i=t(n).appendTo(p),o=i.find("input.title");o.keydown(l),r(o[0]),e(i.find(".powertip")),o.focus()})}function o(){var n=s.find(".form-group-lang").length;t.post("/tmpl/edit/skills/form-group-lang",{index:n},function(n){var i=t(n).appendTo(f),o=i.find("input.title");o.keydown(a),u(o[0]),e(i.find(".powertip")),o.focus()})}function l(e){if(e.keyCode==n.ENTER)return t(this).val().trim()&&i(),e.preventDefault(),!1}function a(e){if(e.keyCode==n.ENTER)return t(this).val().trim()&&o(),e.preventDefault(),!1}function r(e){e=t(e);var n=[];p.find("input.title").each(function(t,i){var o=i.value.trim();e!==i&&o&&n.push(o)}),e.autocomplete({minLength:2,source:function(e,i){t.ajax({type:"POST",dataType:"json",url:"/autocomplete/skill",data:{filter:e.term,except:n},success:i})}}).autocomplete("widget").addClass("sm"),e.autocomplete("instance")._renderItem=function(e,n){return t("<li>").append(n.label).highlight(this.term).appendTo(e)}}function u(e){e=t(e);var n=[];f.find("input.title").each(function(t,i){var o=i.value.trim();e!==i&&o&&n.push(o)}),e.autocomplete({minLength:2,source:function(e,i){t.ajax({type:"POST",dataType:"json",url:"/autocomplete/lang",data:{filter:e.term,except:n},success:i})}}).autocomplete("widget").addClass("sm"),e.autocomplete("instance")._renderItem=function(e,n){return t("<li>").append(n.label).highlight(this.term).appendTo(e)}}var s=t("form#edit-skills-form"),p=s.find(".skills-list"),f=s.find(".langs-list");p.find("input.title").keydown(l).each(function(t,e){r(e)}),f.find("input.title").keydown(a).each(function(t,e){u(e)}),s.find(".add-skill").click(function(t){t.preventDefault(),t.stopPropagation(),i()}),s.find(".add-lang").click(function(t){t.preventDefault(),t.stopPropagation(),o()}),s.on("click",".delete-skill",function(){t(this).closest(".form-group").remove(),t.post("/skill/delete",t(this).data())}),s.on("click",".delete-lang",function(){t(this).closest(".form-group").remove(),t.post("/lang/delete",t(this).data())}),s.submit(function(e){s.find(".form-group-lang").each(function(){var n=t(this),i=n.find(":input.title"),o=n.find(":input.level"),l=i.val(),a=o.val();l&&!a&&(o.focus().parent().addClass("has-error"),e.preventDefault())})}),f.on("change",":input.level",function(){t(this).val()&&t(this).parent().removeClass("has-error")})});