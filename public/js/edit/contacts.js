define(["jquery","i18n"],function(e,t){e("form.toggle-edit-form").each(function(){var o=e(this),i=o.find(".toggle-edit"),n=o.find(':input[type="text"]'),a=n.attr("name"),s=n.closest(".form-group"),r=n.closest(".input-group"),c=e('<p class="help-block small"></p>').insertAfter(r).hide();i.click(function(e){e.preventDefault(),o.toggleClass("open"),o.hasClass("open")?(i.text(t("Отмена")),n.focus()):i.text(t(i.data("has")?"Изменить":"Добавить"))}),o.submit(function(t){t.preventDefault(),e.ajax({url:o.attr("action"),method:"post",data:o.serialize(),beforeSend:function(){o.find(".btn-submit").prop("disabled",!0)},complete:function(){o.find(".btn-submit").prop("disabled",!1)},success:function(e){e.success?e.redirect?window.location.href=e.redirect:window.location.reload():(s.addClass("has-error"),n.val(e.value),c.text(e.errors[a]).show())}})})}),e(".remove-vk").click(function(t){t.preventDefault(),e(this).replaceWith('<img src="/images/loading.svg" class="loader">'),e.post("/vkauth/remove",function(){window.location.reload()})}),e(".remove-facebook").click(function(t){t.preventDefault(),e(this).replaceWith('<img src="/images/loading.svg" class="loader">'),e.post("/fbauth/remove",function(){window.location.reload()})})});