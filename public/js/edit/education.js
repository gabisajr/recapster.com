define(["jquery","i18n","powertip","autosize","caretEnd","selectpicker"],function(e,t,i,n,o){function c(i,n){var o='<option value="">'+t(n?"Не выбрана":"Не выбран")+"</option>";return e.each(i,function(e,t){o+='\n<option value="'+t.id+'">'+t.title+"</option>"}),o}function s(){e(arguments).each(function(){e(this).val("").html("").selectpicker("refresh")})}function r(){e(arguments).each(function(){e(this).show()})}function f(){e(arguments).each(function(){e(this).hide()})}function u(t){t.find("select").selectpicker(),i(t.find(".powertip"));var u=t.find("select.country"),a=t.find("select.city"),l=t.find("select.university"),d=t.find("select.faculty"),h=t.find("select.chair"),p=t.find("select.edu_form"),g=t.find("select.status"),m=t.find("select.start_year"),v=(t.find("select.end_year"),t.find("input.has_text")),y=t.find("textarea.text"),w=a.closest(".form-group"),k=l.closest(".form-group"),x=d.closest(".form-group"),b=h.closest(".form-group"),_=p.closest(".form-group"),D=g.closest(".form-group"),j=m.closest(".form-group"),z=t.find(".text-group"),q=t.find(".text-wrapper");return u.change(function(){s(a,l,d,h),f(k,x,b,_,D,j,z);var t=e(this).val();t||w.hide(),e.get("/country/cities/"+t,{hasUniversity:!0},function(e){a.html(c(e)).selectpicker("refresh"),e.length?w.show():w.hide()})}),a.change(function(){s(l,d,h),f(x,b,_,D,j,z);var t=e(this).val();t||k.hide(),e.post("/city/universities/"+t,function(e){l.html(c(e)).selectpicker("refresh"),e.length?k.show():k.hide()})}),l.change(function(){s(d,h),f(b);var t=e(this).val();t?r(_,D,j,z):f(x,_,D,j,z),e.post("/university/faculties/"+t,function(e){d.html(c(e)).selectpicker("refresh"),e.length?x.show():x.hide()})}),d.change(function(){s(h);var t=e(this).val();t||b.hide(),e.post("/faculty/chairs/"+t,function(e){h.html(c(e,!0)).selectpicker("refresh"),e.length?b.show():b.hide()})}),y.focus(o),n(y),v.change(function(){e(this).is(":checked")?(q.show(),y.focus()):q.hide()}),t}var a=e("form#education-form"),l=a.find(".education-list");a.find(".education-form-group").each(function(){u(e(this))}),a.find(".add-education").click(function(t){t.preventDefault();var i=a.find(".education-form-group").length;e.post("/tmpl/edit/education/form-group",{index:i},function(t){l.append(u(e(t)))})}),a.on("click",".group-delete",function(t){t.preventDefault(),t.stopPropagation(),e(this).closest(".group").remove(),e.post("/education/delete",e(this).data())}),a.submit(function(t){t.preventDefault();var i=a.find('[type="submit"]');e.ajax({url:a.attr("action"),data:a.serialize(),type:a.attr("method"),beforeSend:function(){i.prop("disabled",!0)},complete:function(){i.prop("disabled",!1)},success:function(e){e.success&&(window.scrollTo(0,0),window.location.reload())}})})});