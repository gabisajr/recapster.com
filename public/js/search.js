define(["jquery","post/job","post/review","post/company","highlight"],function(e){function i(i,n){e.ajax({url:a.attr("action"),type:"post",data:i,beforeSend:function(){if(c.prop("disabled",!0),!n){var t="/search?"+e.param(i);window.history.replaceState({},document.title.toString(),t)}},complete:function(){c.prop("disabled",!1)},success:function(i){var a=e(i.results);a.find(".job-post").jobPost(),a.find(".review-post").reviewPost(),a.find(".company-post").companyPost(),n?r.append(a):r.html(a),o.text(i.found),i.found_count?o.show():o.hide(),t(),i.has_more?c.show():c.hide()}})}function t(){var e=l.val();r.highlight(e,{caseSensitive:!1})}var a=e("form.search-form"),o=a.closest(".panel").find(".found-count"),n=a.find(":input[type=reset]"),l=a.find(":input[name=q]"),r=e(".search-results"),c=e(".btn-load-more");a.find("input[name=type]").val();t(),r.find(".job-post").jobPost(),r.find(".review-post").reviewPost(),r.find(".company-post").companyPost(),a.submit(function(t){t.preventDefault(),i(e(this).serializeArray())}),a.find(":radio").on("change",function(i){var t=e(this).attr("name"),o=a.find(':radio[name="'+t+'"]').filter(":checked"),l=o.data("title"),r=o.val(),c=o.closest(".dropdown").find(".dropdown-toggle");r?c.addClass("has-value").find(".title").text(l):c.removeClass("has-value").find(".title").text(c.data("title")),"type"!=t?(n.hide(),a.find(":radio").not('[name="sort"], [name="type"]').filter(":checked").each(function(){e(this).val()&&n.show()}),i.isTrigger||(a.submit(),e(".mobile-filter").find(':radio[name="'+t+'"][value="'+r+'"]').prop("checked",!0).trigger("click"))):window.location.href="/search?type="+r}),n.click(function(i){i.preventDefault(),i.stopPropagation(),a.find(':radio[value=""]').prop("checked",!0).trigger("change"),e(".mobile-filter").find(':radio[value=""]').prop("checked",!0).trigger("click"),n.hide(),a.submit()}),c.click(function(e){e.preventDefault(),e.stopPropagation();var t=a.serializeArray();t.push({name:"skip",value:r.find(".search-post").length}),i(t,!0)}),require(["mobile-view"],function(){var i=e("#mobile-filter"),t=i.find("[data-filter]"),o=a.find(".mobile-filter-open");o.click(function(){i.mobileView("open")}),i.mobileView("option","beforeClose",function(){e(".mobile-filter :radio:checked").filter(function(){return this.value}).length?o.addClass("has-value"):o.removeClass("has-value")}),t.click(function(){var i=e(this).data("filter");e("#mobile-filter-"+i).mobileView("open")}),i.find(".apply-filter").click(function(){t.each(function(){var i=e(this),t=i.data("filter"),o=i.find(".value").data("value")||"";a.find(':radio[name="'+t+'"][value="'+o+'"]').prop("checked",!0).change()}),a.submit(),i.mobileView("close")}),i.find(".reset").click(function(){n.click(),i.mobileView("close")}),e(".mobile-filter").each(function(){var t=e(this),a=t.find(":radio"),o=(t.find("li"),a.attr("name"));a.click(function(){var e=a.filter(":checked"),n=e.val(),l=e.data("title"),r=i.find('[data-filter="'+o+'"]').find(".value");r.text(l).data("value",n),n?r.addClass("has-value"):r.removeClass("has-value"),t.mobileView("close")})})})});